<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>今朝有酒今朝醉的博客 by ZhangXiangQian</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">今朝有酒今朝醉的博客</h1>
        <p class="header">Android 网络加载动态库 .so</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/ZhangXiangQian/zxq.github.io/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/ZhangXiangQian/zxq.github.io/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/ZhangXiangQian/zxq.github.io">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/ZhangXiangQian">ZhangXiangQian</a></p>


      </header>
      <section>
        <p>这几天做项目时遇到一个问题，共17M的Apk，仅两个.so文件就占到14M，就尝试着用户安装完app之后，根据用户需要再加载.so文件，找了之后，方法倒不复杂。</p>

<ol>
<li><p>.so文件的网络下载部分就不展示，</p></li>
<li><p>.so文件存放路径：一般建议存放在 data/data//路径下，代码如下：</p></li>
</ol>

<div class="highlight highlight-source-java"><pre>

    <span class="pl-c">//getFileDir() :/data/data/&lt;packageName&gt;/file/</span>
    <span class="pl-smi">File</span> file2 <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">File</span>(getFilesDir(), <span class="pl-s"><span class="pl-pds">"</span>libBankeysCoreApi.so<span class="pl-pds">"</span></span>);
    <span class="pl-k">try</span> {
            <span class="pl-c">//fos = openFileOutput("libBankeysCoreApi.so", Context.MODE_PRIVATE); </span>
            <span class="pl-c">//第一个参数：文件名，不允许包含分隔符“/”，如果文件不存在，android会自动创建</span>
            <span class="pl-c">//第二个参数：指定操作模式 </span>
　　　　　   <span class="pl-c">//有网友推荐这样使用，但试过之后会保存，提示 "/data/data/&lt;packageName&gt;/app_" 是个路径的错误</span>
            <span class="pl-c">//我放弃这个办法 </span>
            fos <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">FileOutputStream</span>(file2<span class="pl-k">.</span>getAbsoluteFile());
            fos<span class="pl-k">.</span>write(b);
            fos<span class="pl-k">.</span>close();
            <span class="pl-smi">Log</span><span class="pl-k">.</span>e(<span class="pl-s"><span class="pl-pds">"</span>TAG<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-c1">true</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>;<span class="pl-pds">"</span></span> <span class="pl-k">+</span> file2<span class="pl-k">.</span>getAbsolutePath());
        } <span class="pl-k">catch</span> (<span class="pl-smi">FileNotFoundException</span> e) {
            e<span class="pl-k">.</span>printStackTrace();
            <span class="pl-smi">Log</span><span class="pl-k">.</span>e(<span class="pl-s"><span class="pl-pds">"</span>TAG<span class="pl-pds">"</span></span>, e<span class="pl-k">.</span>getMessage());
        } <span class="pl-k">catch</span> (<span class="pl-smi">IOException</span> e) {
            e<span class="pl-k">.</span>printStackTrace();
            <span class="pl-smi">Log</span><span class="pl-k">.</span>e(<span class="pl-s"><span class="pl-pds">"</span>TAG<span class="pl-pds">"</span></span>, e<span class="pl-k">.</span>getMessage());
        } 
        <span class="pl-smi">System</span><span class="pl-k">.</span>load(file2<span class="pl-k">.</span>getAbsolutePath());</pre></div>

<p>另外：lib下库一般会在/data/data//lib/下备份，调用方法做个改动，如下：</p>

<p>System.loadLibrary("");</p>

<p>另，附上：</p>

<p><code>getPackageCodePath():/data/app/com.example.download.sotest-2.apk</code>
<code>getFilesDir():/data/data/com.example.download.sotest/files</code>
<code>getPackageResourcePath():/data/app/com.example.download.sotest-2.apk</code>
<code>getCacheDir():/data/data/com.example.download.sotest/cache</code>
<code>getExternalCacheDir():/storage/emulated/0/Android/data/com.example.download.sotest/cache</code>
<code>getObbDir():/storage/emulated/0/Android/obb/com.example.download.sotest</code>
<code>getFilesDir():/data/data/com.example.download.sotest/files</code></p>

<p>上面部分我试过之后是可行的，希望能帮到大家。</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
